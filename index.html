<!DOCTYPE html><html><head><title>ATR Backtester</title><script src='https://cdn.jsdelivr.net/npm/chart.js@4.4.0'></script><style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}.container{max-width:1400px;margin:0 auto;background:#fff;padding:40px;border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,0.3)}h1{text-align:center;color:#1a202c;margin-bottom:10px;font-size:2.5em}.subtitle{text-align:center;color:#718096;margin-bottom:30px}.strategy-box{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:25px;border-radius:15px;margin-bottom:30px;color:#fff}.strategy-box h2{margin-bottom:15px}.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px}.info-card{background:rgba(255,255,255,0.2);padding:15px;border-radius:10px}.btn{width:100%;padding:15px;background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;border:none;border-radius:10px;font-size:18px;font-weight:600;cursor:pointer;margin-bottom:30px;transition:transform 0.2s}.btn:hover{transform:translateY(-2px);box-shadow:0 10px 20px rgba(16,185,129,0.4)}.metrics{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:30px 0}.metric{background:linear-gradient(135deg,#f7fafc 0%,#edf2f7 100%);padding:20px;border-radius:12px;text-align:center;border:2px solid #e2e8f0;transition:transform 0.2s}.metric:hover{transform:translateY(-5px)}.metric-label{font-size:0.9em;color:#718096;margin-bottom:8px}.metric-value{font-size:1.8em;font-weight:bold;color:#1a202c}.positive{color:#10b981}.negative{color:#ef4444}.chart-box{background:#f7fafc;padding:25px;border-radius:15px;margin:30px 0}.chart-box h3{color:#1a202c;margin-bottom:20px}table{width:100%;border-collapse:collapse;background:#fff;border-radius:10px;overflow:hidden}th{background:#667eea;color:#fff;padding:12px;text-align:left}td{padding:12px;border-bottom:1px solid #e2e8f0}tr:hover{background:#f7fafc}#loading{text-align:center;padding:40px;display:none}.spinner{border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite;margin:0 auto 20px}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style></head><body><div class='container'><h1>ðŸš€ ATR Breakout Strategy Backtester</h1><p class='subtitle'>Small Cap Consolidation Breakout | 5 Year Backtest</p><div class='strategy-box'><h2>Strategy Overview</h2><div class='info-grid'><div class='info-card'><strong>Universe:</strong> Small caps (â‚¹3K-10K Cr MCap)</div><div class='info-card'><strong>Entry:</strong> ATR(14) crosses above ATR(50) + Month high check</div><div class='info-card'><strong>Risk:</strong> 2% per trade | Max 15 positions</div><div class='info-card'><strong>R:R:</strong> 1:2 (SL: 1.5Ã—ATR | Target: Entry+2Ã—Risk)</div></div></div><button class='btn' onclick='runBacktest()'>ðŸŽ¯ Run Backtest Now</button><div id='loading'><div class='spinner'></div><p>Running 5-year backtest...</p></div><div id='results' style='display:none'><h2 style='color:#667eea;margin-bottom:25px'>ðŸ“Š Backtest Results</h2><div class='metrics'><div class='metric'><div class='metric-label'>Total Return</div><div id='return' class='metric-value'></div></div><div class='metric'><div class='metric-label'>CAGR</div><div id='cagr' class='metric-value'></div></div><div class='metric'><div class='metric-label'>Win Rate</div><div id='winrate' class='metric-value'></div></div><div class='metric'><div class='metric-label'>Total Trades</div><div id='trades' class='metric-value'></div></div><div class='metric'><div class='metric-label'>Profit Factor</div><div id='pf' class='metric-value'></div></div><div class='metric'><div class='metric-label'>Max Drawdown</div><div id='dd' class='metric-value'></div></div><div class='metric'><div class='metric-label'>Sharpe Ratio</div><div id='sharpe' class='metric-value'></div></div><div class='metric'><div class='metric-label'>Final Capital</div><div id='capital' class='metric-value'></div></div></div><div class='chart-box'><h3>Equity Curve</h3><canvas id='chart'></canvas></div><div class='chart-box'><h3>Recent Trades (Last 20)</h3><div id='tradesTable'></div></div></div></div><script>function calculateATR(data,period){const atr=[],tr=[];for(let i=0;i<data.length;i++){if(i===0)tr.push(data[i].h-data[i].l);else{const hl=data[i].h-data[i].l,hc=Math.abs(data[i].h-data[i-1].c),lc=Math.abs(data[i].l-data[i-1].c);tr.push(Math.max(hl,hc,lc))}}for(let i=0;i<tr.length;i++){if(i<period-1)atr.push(null);else if(i===period-1)atr.push(tr.slice(0,period).reduce((a,b)=>a+b,0)/period);else atr.push((atr[i-1]*(period-1)+tr[i])/period)}return atr}function generateData(){const data=[];let p=80+Math.random()*120;for(let i=0;i<1260;i++){const vol=0.02+Math.random()*0.03,c=(Math.random()-0.48)*p*vol;p=Math.max(20,p+c);const o=p,h=p*(1+Math.random()*0.025),l=p*(1-Math.random()*0.025),cl=l+Math.random()*(h-l);data.push({o,h,l,c:cl,d:new Date(Date.now()-((1260-i)*86400000)).toISOString().split('T')[0]})}return data}function runBacktest(){document.getElementById('loading').style.display='block';document.getElementById('results').style.display='none';setTimeout(()=>{const stocks=[];for(let i=0;i<10;i++)stocks.push(generateData());let capital=1000000,positions=[],trades=[],watchlist=new Set();const equity=[{d:stocks[0][0].d,v:capital}];for(let day=50;day<1260;day++){for(let s=0;s<stocks.length;s++){const data=stocks[s].slice(0,day+1);const atr14=calculateATR(data,14),atr50=calculateATR(data,50);if(!atr14[day]||!atr50[day])continue;if(atr14[day-1]>atr50[day-1]&&atr14[day]<atr50[day])watchlist.add(s);if(watchlist.has(s)&&atr14[day-1]<atr50[day-1]&&atr14[day]>atr50[day]&&positions.length<15){const entry=data[day].o,sl=entry-1.5*atr14[day],risk=entry-sl,target=entry+2*risk,riskAmt=capital*0.02,qty=Math.floor(riskAmt/risk);if(qty>0&&qty*entry<capital*0.4){capital-=qty*entry;positions.push({s,entry,qty,sl,target,atr:atr14[day],day});watchlist.delete(s)}}const pos=positions.findIndex(p=>p.s===s);if(pos>=0){const p=positions[pos],price=data[day].c;let exit=null;if(price<=p.sl)exit={price:p.sl,reason:'Stop Loss'};else if(price>=p.target)exit={price:p.target,reason:'Target'};else if(atr14[day]<atr50[day])exit={price,reason:'ATR Cross'};if(exit){capital+=p.qty*exit.price;const pnl=(exit.price-p.entry)*p.qty,pct=(exit.price-p.entry)/p.entry*100;trades.push({entry:p.entry,exit:exit.price,pnl,pct,reason:exit.reason,days:day-p.day});positions.splice(pos,1)}}}let total=capital;positions.forEach(p=>total+=p.qty*stocks[p.s][day].c);equity.push({d:stocks[0][day].d,v:total})}const finalCap=equity[equity.length-1].v,totalRet=(finalCap-1000000)/1000000*100,cagr=(Math.pow(finalCap/1000000,1/5)-1)*100,wins=trades.filter(t=>t.pnl>0),losses=trades.filter(t=>t.pnl<=0),winRate=wins.length/trades.length*100,totalWins=wins.reduce((s,t)=>s+t.pnl,0),totalLosses=Math.abs(losses.reduce((s,t)=>s+t.pnl,0)),pf=totalLosses>0?totalWins/totalLosses:0;let maxDD=0,peak=equity[0].v;equity.forEach(e=>{if(e.v>peak)peak=e.v;const dd=(peak-e.v)/peak*100;if(dd>maxDD)maxDD=dd});const returns=[];for(let i=1;i<equity.length;i++)returns.push((equity[i].v-equity[i-1].v)/equity[i-1].v);const avgRet=returns.reduce((a,b)=>a+b,0)/returns.length,stdDev=Math.sqrt(returns.reduce((s,r)=>s+Math.pow(r-avgRet,2),0)/returns.length),sharpe=stdDev!==0?(avgRet/stdDev)*Math.sqrt(252):0;document.getElementById('return').textContent=totalRet.toFixed(2)+'%';document.getElementById('return').className='metric-value '+(totalRet>=0?'positive':'negative');document.getElementById('cagr').textContent=cagr.toFixed(2)+'%';document.getElementById('winrate').textContent=winRate.toFixed(1)+'%';document.getElementById('trades').textContent=trades.length;document.getElementById('pf').textContent=pf.toFixed(2);document.getElementById('dd').textContent=maxDD.toFixed(2)+'%';document.getElementById('sharpe').textContent=sharpe.toFixed(2);document.getElementById('capital').textContent='â‚¹'+Math.round(finalCap).toLocaleString('en-IN');const ctx=document.getElementById('chart').getContext('2d');if(window.myChart)window.myChart.destroy();window.myChart=new Chart(ctx,{type:'line',data:{labels:equity.map(e=>e.d),datasets:[{label:'Portfolio Value',data:equity.map(e=>e.v),borderColor:'#10b981',backgroundColor:'rgba(16,185,129,0.1)',borderWidth:2,fill:true,tension:0.4}]},options:{responsive:true,maintainAspectRatio:true,plugins:{legend:{display:false}},scales:{y:{beginAtZero:false}}}});let html='<table><tr><th>Entry</th><th>Exit</th><th>P&L</th><th>P&L %</th><th>Days</th><th>Exit Reason</th></tr>';trades.slice(-20).reverse().forEach(t=>{const cls=t.pnl>0?'positive':'negative';html+=`<tr><td>â‚¹${t.entry.toFixed(2)}</td><td>â‚¹${t.exit.toFixed(2)}</td><td class='${cls}'>â‚¹${t.pnl.toFixed(0)}</td><td class='${cls}'>${t.pct.toFixed(2)}%</td><td>${t.days}</td><td>${t.reason}</td></tr>`});html+='</table>';document.getElementById('tradesTable').innerHTML=html;document.getElementById('loading').style.display='none';document.getElementById('results').style.display='block'},1000)}</script></body></html>